<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8">
		<meta name="X-UA-Compatible" content="IE=edge">
		<title>sandbox(local)</title>
	</head>

	<script type="text/javascript">
		__USHELL__CONFIG__
	</script>

	<script id="sap-ui-bootstrap"
		src="/resources/sap-ui-core.js"
		data-sap-ui-libs="sap.m,sap.ushell,sap.uxap,sap.f,sap.ui.table,sap.ui.comp,sap.ui.fl"
		data-sap-ui-async="true"
		data-sap-ui-theme="__THEME__"
		data-sap-ui-compatVersion="edge"
		data-sap-ui-bindingSynax="complex"
		data-sap-ui-resourceroots='__RESOURCE__ROOTS__CONFIG__'
        >
        // data-sap-ui-flexibilityservices='[{
        //     "applyConnector":"PreviewConnector",
        //     "writeConnector":"sap/ui/fl/write/connectors/BaseConnector",
        //     "custom":true,
        //     "layers":["VENDOR"]
        // }]'
	</script>

	<script id="sap-ushell-bootstrap"
		src="/test-resources/sap/ushell/bootstrap/sandbox.js">
	</script>

	<script type="text/javascript">
        
        function fnHandleHashChange(FakeLrepConnector){
            const parser = sap.ushell.Container.getService("URLParsing");
            const appConfig = window["z-workpace-config"].applications;
            const hash = parser.parseShellHash(window.location.hash) || {};
            const {semanticObject, action} = hash;

            if(!semanticObject || !action || semanticObject === "Shell" ){
                return;
            }

            if(appConfig && appConfig[`${semanticObject}-${action}`]){
                const id = appConfig[`${semanticObject}-${action}`]["id"];
                const _version = appConfig[`${semanticObject}-${action}`]["_version"];

                if(id){
                    FakeLrepConnector.enableFakeConnector(
                        `/appChanges?semanticObject=${semanticObject}&action=${action}`,
                        id,
                        _version
                    );
                }
            }
        }

		sap.ui.getCore().attachInit(function(){
			sap.ui.require([
				"flp/root/mockservers/mockserver",
                "sap/ui/fl/FakeLrepConnector"
			], function(mockserver, FakeLrepConnector){

                fnHandleHashChange = fnHandleHashChange.bind(null, FakeLrepConnector);

				mockserver.init(__MOCK__SETTINGS__)
					.finally(() => {
						sap.ushell.__sandbox__._bootstrap(function () {
							sap.ushell.Container.createRenderer().placeAt("content");

                            fnHandleHashChange();
                            window.addEventListener("hashchange", fnHandleHashChange);
						});
					});
			});

		});
	</script>

	<body class="sapUiBody" id="content">
	</body>

</html>